---
title: "lowreporting_zonal"
author: "Chase Tarr"
date: "2023-03-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#attach packages
library(tidyverse)
library(here)
library(sf)
library(tmap)
library(lubridate)
library(ResourceSelection)
library(rmapshaper)
library(terra)

#mia, chase, and claire's file path

gdrive_data <- "/Volumes/GoogleDrive/Shared drives/Black_Bear_Aware/gdrive_data"

#mia's file path
#gdrive_data <- "/Users/mia/Library/CloudStorage/GoogleDrive-mguarnieri@ucsb.edu/Shared drives/Black_Bear_Aware/gdrive_data"

#sam's file path
#gdrive_data <- "G:/Shared drives/Black_Bear_Aware/gdrive_data"

```

# exploring high conflict points where nonreporting is occurring and understanding the demographics of the areas
```{r}
#loading in data
mod3_rast <- rast(here(gdrive_data, "/AnalysisData/model_outputs/projected_mod3_clim_map_squared.tif"))

ca_raster <- rast(here(gdrive_data, "/IntermediateData/IntermediateData_Files/CARaster_Tiger_Formatted/formattedcaraster.tif"))

county_demographics <- vect(here(gdrive_data, "/IntermediateData/IntermediateData_Files/census_demographics/MSSA_Detail.shp"))
```

```{r}
census_df <- as.data.frame(county_demographics)
plot(proj_high_conflict)
plot(county_demographics)
```


#```{r}
#reformatt raster

demog_calber <- project(county_demographics, ca_raster)

demog_mask <- mask(demog_calber, ca_raster)

plot(demog_mask)
#```

```{r}
demog_calber_shp <- project(county_demographics, ca_raster)

demog_crop <- crop(demog_calber_shp, ca_raster) %>% 
  st_as_sf()
  
demog_group <- demog_crop %>% 
  group_by(COUNTY) %>% 
  summarize(mean_white=mean(PCT_WHITE), mean_black = mean(PCT_BLACK), mean_asian=mean(PCT_ASIAN), mean_amind=mean(PCT_AMIND_), mean_hispanic=mean(PCT_HSPNC), mean_islander=mean(PCT_ISLAND), pop_under18=mean(PCT_UNDR18), pop_over65=mean(PCT_65OVER))



plot(demog_group)
```

```{r}
#run the zonal stats
zonal_statistic <-extract(mod3_rast, demog_crop, fun="mean", na.rm=TRUE) 

colnames(zonal_statistic) = c("COUNTY", "Conflict_Risk")

demog_zonal <- full_join(demog_group, zonal_statistic, by = "COUNTY")
```


