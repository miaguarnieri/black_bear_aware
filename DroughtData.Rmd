---
title: "Drought Data"
author: "Chase Tarr"
date: '2022-10-20'
output: html_document
---

```{r}
knitr::opts_chunk$set(echo = TRUE)
#attach packages
#note - Loading all of the ones Jason used, I don't think we will need all of them 

library(tidyverse)
library(here)
library(terra)
library(sf)
library(tmap)
library(beepr)
library(rgeos)
library(rmapshaper)
library(rgdal)
library(raster)
library(stars)
library(purrr)

#mia and claire's file path
gdrive_data <- "/Volumes/GoogleDrive/Shared drives/Black_Bear_Aware/gdrive_data"

#sam's file path
#gdrive_data <- "G:/Shared drives/Black_Bear_Aware/gdrive_data"
```

```{r}
ca_raster <- rast(here(gdrive_data, "/IntermediateData/IntermediateData_Files/CARaster_Tiger_Formatted/formattedcaraster.tif"))
```

# Read in drought data

```{r}
drought2016 <- vect(here(gdrive_data, "/InputData/InputData_Files/Drought/us_drought_monitor/2016/USDM_20161227.shp")) %>% 
  terra::project(ca_raster)

```




```{r}
drought_2022 <- lapply(c("D0", "D1", "D2", "D3", "D4"), function(i){
  shp <- readOGR(here(gdrive_data, "/InputData/InputData_Files/Drought/us_drought_monitor/2022/USDM_20221025.shp"))
  template <- raster(ext = extent(shp), crs = projection(shp))
  rst <- rasterize(shp, template, fun = 'first')
})

plot(drought_2022[[2]], xlab = "lon", ylab = "lat", main = "Drought Index 2022")
```

```{r}
head(drought_2022)

#merge the layers of the list
drought2022_merged <- terra::merge(drought_2022[[1]], drought_2022[[2]], drought_2022[[3]], drought_2022[[4]], drought_2022[[5]])

#convert to a spatraster object for use in terra
d2022_rast <- rast(drought2022_merged)

#reproject
drought_2022_calbers <- terra::project(d2022_rast, ca_raster)

#mask to CA
d2022_masked <- mask(drought_2022_calbers, ca_raster)

#test plot
plot(d2022_masked)


drought_2016_mask <- crop(drought_2016_calbers, ca_raster)

drought_2016_raster <- rasterize(drought_2016_mask, ca_raster)

drought_convert <- rasterize(drought_2022, r, field = droiught_2022$ID)

```


```{r}
saverast <- function(x){
  
 name <- paste0(deparse(substitute(x)), ".tif") #the name of the file will be the same as the input object, plus '.tif' at the end
  
#write the raster into the correct folder in drive (the path will need to be updated for other files) and save it as a geotiff
  
writeRaster(x, filename = here(gdrive_data, "/IntermediateData/IntermediateData_Files/drought/us_drought_monitor/2022", name), filetype = "Gtiff", overwrite=TRUE)
}

saverast(drought_2022)
```

